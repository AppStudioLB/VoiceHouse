(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{20:function(e,t,n){e.exports=n(31)},25:function(e,t,n){},31:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(17),c=n.n(o),s=(n(25),n(9),n(1)),i=n.n(s),u=n(2),l=n(5),f=n(6),p=n(8),d=n(7),m=function(){var e=Object(u.a)(i.a.mark((function e(t,n,a,r,o,c){var s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.addStream(n),e.next=4,t.createOffer();case 4:return s=e.sent,e.next=7,t.setLocalDescription(s);case 7:r(a,s,o,c),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,a,r,o,c){return e.apply(this,arguments)}}(),v=function(){var e=Object(u.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 3:return t=e.sent,e.abrupt("return",t);case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=Object(u.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new RTCPeerConnection({iceServers:[{urls:"stun:stun2.1.google.com:19302"}]}),e.abrupt("return",t);case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),b=function(e,t,n,a,r,o){e.onicecandidate=function(e){e.candidate&&o(n,e.candidate,a,t)},e.ontrack=function(e){r.srcObject!==e.streams[0]&&(r.srcObject=e.streams[0])}},w=function(){var e=Object(u.a)(i.a.mark((function e(t,n,a,r,o,c){var s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.addStream(n),s=JSON.parse(a.offer),t.setRemoteDescription(s),e.next=6,t.createAnswer();case 6:u=e.sent,t.setLocalDescription(u),r(a.from,u,o,c),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n,a,r,o,c){return e.apply(this,arguments)}}(),y=n(11),C=n.n(y),g=(n(16),{apiKey:"AIzaSyConcvi0z09NQwb_qWx9e91oWjb3XJtmp8",authDomain:"voice-house-16837.firebaseapp.com",databaseURL:"https://voice-house-16837-default-rtdb.firebaseio.com/",projectId:"voice-house-16837",storageBucket:"voice-house-16837.appspot.com",messagingSenderId:"834484574470",appId:"1:834484574470:web:efae01fe37ac190c58e687"}),k=function(){var e=Object(u.a)(i.a.mark((function e(t,n,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.ref("/notifs/"+t).remove();case 2:n.ref("/notifs/"+t).on("value",(function(e){e.exists()&&a(e.val(),t)}));case 3:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),x=function(){var e=Object(u.a)(i.a.mark((function e(t,n,a,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.ref("/notifs/"+t).set({type:"offer",from:r,offer:JSON.stringify(n)});case 2:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),O=function(){var e=Object(u.a)(i.a.mark((function e(t,n,a,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.ref("/notifs/"+t).update({type:"answer",from:r,answer:JSON.stringify(n)});case 2:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),R=function(){var e=Object(u.a)(i.a.mark((function e(t,n,a,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.ref("/notifs/"+t).update({type:"candidate",from:r,candidate:JSON.stringify(n)});case 2:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),j=(n(30),n(19)),S=n.n(j),E=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).onLoginClicked=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.props.onLogin(a.state.username);case 2:a.setState({isLoggedIn:!0});case 3:case"end":return e.stop()}}),e)}))),a.onStartCallClicked=function(){a.props.startCall(a.state.username,a.state.userToCall)},a.renderVideos=function(){return r.a.createElement("div",{className:S()("videos",{active:a.state.isLoggedIn})},r.a.createElement("div",null,r.a.createElement("label",null,a.state.username),r.a.createElement("video",{ref:a.props.setLocalVideoRef,autoPlay:!0,playsInline:!0})),r.a.createElement("div",null,r.a.createElement("label",null,a.props.connectedUser),r.a.createElement("video",{ref:a.props.setRemoteVideoRef,autoPlay:!0,playsInline:!0})))},a.renderForms=function(){return a.state.isLoggedIn?r.a.createElement("div",{key:"a",className:"form"},r.a.createElement("label",null,"Call to"),r.a.createElement("input",{value:a.state.userToCall,type:"text",onChange:function(e){return a.setState({userToCall:e.target.value})}}),r.a.createElement("button",{onClick:a.onStartCallClicked,id:"call-btn",className:"btn btn-primary"},"Call")):r.a.createElement("div",{key:"b",className:"form"},r.a.createElement("label",null,"Type a name"),r.a.createElement("input",{value:a.state.username,type:"text",onChange:function(e){return a.setState({username:e.target.value})}}),r.a.createElement("button",{onClick:a.onLoginClicked,id:"login-btn",className:"btn btn-primary"},"Login"))},a.state={isLoggedIn:!1,userToCall:null,username:null},a}return Object(f.a)(n,[{key:"render",value:function(){return r.a.createElement("section",{id:"container"},this.props.connectedUser?null:this.renderForms(),this.renderVideos())}}]),n}(r.a.Component),L=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).componentDidMount=Object(u.a)(i.a.mark((function e(){var t,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.a.initializeApp(g),e.next=3,v();case 3:return t=e.sent,a.localVideoRef.srcObject=t,e.next=7,h();case 7:n=e.sent,a.setState({database:C.a.database(),localStream:t,localConnection:n});case 9:case"end":return e.stop()}}),e)}))),a.startCall=function(){var e=Object(u.a)(i.a.mark((function e(t,n){var r,o,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=a.state,o=r.localConnection,c=r.database,s=r.localStream,b(o,t,n,c,a.remoteVideoRef,R),m(o,s,n,x,c,t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.onLogin=function(){var e=Object(u.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(t,a.state.database,a.handleUpdate);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.setLocalVideoRef=function(e){a.localVideoRef=e},a.setRemoteVideoRef=function(e){a.remoteVideoRef=e},a.handleUpdate=function(e,t){var n=a.state,r=n.localConnection,o=n.database,c=n.localStream;if(e)switch(e.type){case"offer":a.setState({connectedUser:e.from}),b(r,t,e.from,o,a.remoteVideoRef,R),w(r,c,e,O,o,t);break;case"answer":a.setState({connectedUser:e.from}),function(e,t){var n=JSON.parse(t.answer);e.setRemoteDescription(n)}(r,e);break;case"candidate":!function(e,t){var n=JSON.parse(t.candidate);e.addIceCandidate(new RTCIceCandidate(n))}(r,e)}},a.state={database:null,connectedUser:null,localStream:null,localConnection:null},a.localVideoRef=r.a.createRef(),a.remoteVideoRef=r.a.createRef(),a}return Object(f.a)(n,[{key:"shouldComponentUpdate",value:function(e,t){return this.state.database===t.database&&(this.state.localStream===t.localStream&&this.state.localConnection===t.localConnection)}},{key:"render",value:function(){return r.a.createElement(E,{startCall:this.startCall,onLogin:this.onLogin,setLocalVideoRef:this.setLocalVideoRef,setRemoteVideoRef:this.setRemoteVideoRef,connectedUser:this.state.connectedUser})}}]),n}(r.a.Component);var V=function(){return r.a.createElement("div",{className:"app"},r.a.createElement("h1",null,"React Video Chat App"),r.a.createElement("h2",null,"WebRTC + Firebase"),r.a.createElement(L,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(V,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},9:function(e,t,n){}},[[20,1,2]]]);
//# sourceMappingURL=main.bc44f814.chunk.js.map